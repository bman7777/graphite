<!DOCTYPE HTML>
<html>
<head>
	<title>TouchTest</title>	<LINK REL="SHORTCUT ICON" HREF="http://www.local-binary.com/root/img/web/localbinaryicon.ico" />
	
	<script src="kinetic-v4.5.4.min.js"></script>
    <script>
		function start()
		{
			var container = document.getElementById("container");
			var stage = new Kinetic.Stage({container: container, width:2000, height:2000});
			
			var layer = new Kinetic.Layer();
			var msgLayer = new Kinetic.Layer();
			stage.add(layer);
			stage.add(msgLayer);
			
			var circle = new Kinetic.Circle(
			{
				fill: '#FF0000',
				stroke: 'black',
				strokeWidth: 3,
				radius: 100,
				x: 250,
				y: 250,
				draggable: false /*true*/
			});
			layer.add(circle);
			layer.draw();
			
			function writeMessage(messageLayer, message) 
			{
				var context = messageLayer.getContext();
				messageLayer.clear();
				context.font = '18pt Calibri';
				context.fillStyle = 'black';
				context.fillText(message, 10, 25);
			}
			
			/*var dragText = new Kinetic.Text(
			{
				text:"Not dragging circle",
				x: 100,
				y: 25,
				fontSize: 12,
				fill: 'black'
			});
			layer.add(dragText);
			var dragStageText = new Kinetic.Text(
			{
				text:"Not dragging stage",
				x: 100,
				y: 75,
				fontSize: 12,
				fill: 'black'
			});
			layer.add(dragStageText);
			var touchText = new Kinetic.Text(
			{
				text:"Not touching",
				x: 100,
				y: 50,
				fontSize: 12,
				fill: 'black'
			});
			layer.add(touchText);
			layer.draw();*/
			
			/*circle.on('touchstart', function(event)
			{
				event.preventDefault();
				touchText.setText("start touching");
				layer.draw();
				
				var touchDrag = function(event)
				{
					touchText.setText("touching: ("+event.changedTouches[0].pageX+", "+event.changedTouches[0].pageY+")");
					circle.setX(event.changedTouches[0].pageX);
					circle.setY(event.changedTouches[0].pageY);
					layer.draw();
				};
				
				var endTouchDrag = function()
				{
					touchText.setText("not touching");
					layer.draw();
					this.off('touchmove', touchDrag);
					this.off('touchend', endTouchDrag);
					//document.body.style.position = "relative"; 
				};
				
				//this.getStage().getContent().addEventListener('touchmove', touchDrag);
				//this.getStage().getContent().addEventListener('touchend', endTouchDrag);
				
				this.on('touchmove', touchDrag);
				this.on('touchend', endTouchDrag);
			});*/
			
			circle.on('touchmove', function()
			{
				var pos  = stage.getTouchPosition();
				if(pos == null)
				{
					writeMessage(msgLayer, "touching (with no chnages)");
				}
				else
				{
					writeMessage(msgLayer, "touching ("+pos.x+", "+pos.y+")");
				}
			});
			
			/*circle.on('dragstart', function(event)
			{
				dragText.setText("start dragging circle");
				layer.draw();
				document.body.style.position = "fixed"; 
				
				var endDrag = function()
				{
					dragText.setText("not dragging circle");
					layer.draw();
					this.off('dragend', endDrag);
					document.body.style.position = "relative"; 
				};
				
				this.on('dragend', endDrag);
			});*/
			
			/*circle.on('dragstart', function(event)
			{
				dragText.setText("start dragging");
				layer.draw();
				
				
				var touchDrag = function(event)
				{
					dragText.setText("dragging("+this.getX()+", "+this.getY()+")");
					layer.draw();
				};
				
				var endTouchDrag = function()
				{
					touchText.setText("not dragging");
					layer.draw();
					//this.removeEventListener('dragmove', touchDrag);
					//this.removeEventListener('dragend', endTouchDrag);
					
					this.off('dragmove', touchDrag);
					this.off('dragend', endTouchDrag);
					document.body.style.position = "relative"; 
				};
				
				//this.getStage().getContent().addEventListener('dragmove', touchDrag);
				//this.getStage().getContent().addEventListener('dragend', endTouchDrag);
				
				this.on('dragmove', touchDrag);
				this.on('dragend', endTouchDrag);
			});
			
			circle.on('touchmove', function(event)
			{
				//event.cancelBubble = true;
				
				
				this.setX(event.changedTouches[0].clientX);
				this.setY(event.changedTouches[0].clientY);
				layer.draw();
			});*/
			
			/*document.body.addEventListener('touchmove', function(event)
			{
				event.preventDefault();
			}, false);
			
			*/
			
			/*circle.on('dragmove', function(event)
			{
				event.cancelBubble = true;
			});
			
			stage.on('dragstart', function(event)
			{
				dragStageText.setText("start dragging stage");
				layer.draw();
				
				var endDrag = function()
				{
					dragStageText.setText("not dragging stage");
					layer.draw();
					this.off('dragend', endDrag);
				};
				
				this.on('dragend', endDrag);
			});
			
			stage.on('dragmove', function(event)
			{
				dragStageText.setText("dragging stage");
				layer.draw();
			});*/
			
			
			/*window.onscroll = function(event)
			{
				console.log("window scroll");
			};*/
		}
	</script>
	
</head>
<body onload="start()" onmousedown="return false;">
    
    <div id="container"></div>
	
</body>
</html>